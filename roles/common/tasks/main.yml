---
- name: Get the kernel version
  command: "uname -r"
  register: uname

- name: full system upgrade
  pacman:
    update_cache: yes
    upgrade: yes

- name: install git and base devel group
  pacman:
    name: ['base-devel', 'git']

- name: get ready to build from AUR
  shell: |
    mkdir /home/build
    chgrp nobody /home/build
    chmod g+ws /home/build
    setfacl -m u::rwx,g::rwx /home/build
    setfacl -d --set u::rwx,g::rwx,o::- /home/build
    
    exit 0

- git:
    repo: 'https://aur.archlinux.org/ansible-aur-git.git'
    dest: /home/build/ansible-aur-git
  
- name: build ansible AUR module
  command: "makepkg"
  args:
    chdir: /home/build/ansible-aur-git
  become: yes
  become_user: nobody
  
